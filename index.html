<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ROS2 Tank — OpenCV.js Demo</title>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
<style>
  .hero{padding:2.5rem 0;background:#0f172a;color:#e2e8f0}
  .grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  @media(max-width:900px){.grid2{grid-template-columns:1fr}}
  video,canvas{width:100%;height:auto;border-radius:12px;background:#0b1020}
  .controls{display:flex;gap:.75rem;align-items:center;flex-wrap:wrap;margin:.75rem 0}
  pre{background:#0b1020;color:#c7d2fe;border-radius:12px;padding:12px}
</style>
<!-- OpenCV (WASM) -->
<script async src="https://docs.opencv.org/4.x/opencv.js"
        onload="onOpenCvReady()" onerror="onOpenCvError()"></script>
</head>
<body>
  <nav class="container-fluid">
    <ul><li><strong>ROS2 Tank Robot</strong></li></ul>
    <ul>
      <li><a href="#demo">Demo</a></li>
      <li><a href="https://github.com/scanlonowen/robot-tank-ros2">GitHub</a></li>
    </ul>
  </nav>

  <header class="hero">
    <div class="container">
      <h1>Tracked robot with ROS 2 + OpenCV</h1>
      <p>Webcam red-object tracking in-browser. HSV mask → centroid → velocity hints (vx, wz).</p>
    </div>
  </header>

  <main class="container" id="demo">
    <h2>Live OpenCV.js Demo</h2>
    <div class="grid2">
      <article><h4>Camera</h4><video id="video" playsinline autoplay muted></video></article>
      <article><h4>Processed</h4><canvas id="canvas"></canvas></article>
    </div>

    <div class="controls">
      <button id="startBtn" disabled>Start</button>
      <button id="stopBtn" disabled>Stop</button>
      <label>Resolution
        <select id="resSelect"><option>640x480</option><option>1280x720</option></select>
      </label>
      <label>Hue <input type="number" id="hLow" value="0" min="0" max="179">–<input type="number" id="hHigh" value="10" min="0" max="179"></label>
      <label>S/V min <input type="number" id="sMin" value="120" min="0" max="255"> / <input type="number" id="vMin" value="120" min="0" max="255"></label>
    </div>

    <pre id="stats">Loading OpenCV…</pre>
  </main>

<script>
let video, canvas, ctx, stream, rafId;
let cap, src, hsv, mask1, mask2, mask, kernel, contours, hierarchy;
let running=false;
const $=id=>document.getElementById(id);

function onOpenCvReady(){ $('stats').textContent='OpenCV loaded. Click Start.'; $('startBtn').disabled=false; }
function onOpenCvError(){ $('stats').textContent='Failed to load OpenCV.js'; }

async function start(){
  const [w,h]=$('resSelect').value.split('x').map(Number);
  stream=await navigator.mediaDevices.getUserMedia({video:{width:w,height:h},audio:false});
  video.srcObject=stream; await video.play();
  canvas.width=video.videoWidth; canvas.height=video.videoHeight;

  cap=new cv.VideoCapture(video);
  src=new cv.Mat(video.
